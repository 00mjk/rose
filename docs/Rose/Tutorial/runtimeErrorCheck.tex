\chapter{Runtime Error Check}

This chapter demonstrates the capabilities of ROSE to check for runtime errors. Instead of a segmentation fault,
a valid error message with line number and associated file is printed.

For this, the original code is instrumented (transformed) with calls to a function that checks whether a variable is NULL at 
any given location in the code. In particular, this example searches (amongst other things) for all VarRefExp expressions in a program.
When found, a function call to check\_var(SgNode* n, std::string desc) is inserted before the statement containing that expression.
The first parameter to check\_var contains the variable to check and the second parameter the line number and file description.

\section{Interface}

The runtime check is performed by the following lines of code:


\begin{verbatim}
SgProject* project  = frontend(argc,argv);
RuntimeInstrumentation* runtime = new RuntimeInstrumentation();
runtime->run(project);
return backend(project); 
\end{verbatim}


\section{Example 1}

As an example, consider the input program in Figure~\ref{Tutorial:exampledefuseCode}.

\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/input_runtimeErrorCheck.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/input_runtimeErrorCheck.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code.}
\label{Tutorial:exampledefuseCode}
\end{figure}

ROSE traverses the program and inserts check\_var() statements at locations before the variables are read.
Besides VarRefExp, the runtime error checker looks also for isSgPointerDerefExp and isSgPntrArrRefExp expressions.
The output program can be found in Figure~\ref{Tutorial:exampledefuseCode2}.


\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/rose_input_runtimeErrorCheck.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/rose_runtimeErrorCheck.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Transformed source code.}
\label{Tutorial:exampledefuseCode2}
\end{figure}

Finally, if the new code is executed -- the obvious segmentation fault is caught and the following 
error message is printed to the screen, cf. Figure~\ref{Tutorial:exampledefuseCode3}.

\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/output_runtimeCheck.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/output_runtimeCheck.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Execution of transformed source code.}
\label{Tutorial:exampledefuseCode3}
\end{figure}







\section{Example 2}

The following demonstrates a second example. The input code is illustrated in Figure~\ref{Tutorial:exampledefuseCodeb}.

\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/input_runtimeErrorCheck2.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/input_runtimeErrorCheck2.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code.}
\label{Tutorial:exampledefuseCodeb}
\end{figure}

The transformed code is shown in Figure~\ref{Tutorial:exampledefuseCodeb2}.

\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/rose_input_runtimeErrorCheck2.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/rose_runtimeErrorCheck2.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Transformed source code.}
\label{Tutorial:exampledefuseCodeb2}
\end{figure}

The new program when executed prints the error message shows in Figure~\ref{Tutorial:exampledefuseCodeb3}.

\begin{figure}[!h]
{\indent
{\mySmallFontSize
% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/output_runtimeCheck2.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/output_runtimeCheck2.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Execution of transformed source code.}
\label{Tutorial:exampledefuseCodeb3}
\end{figure}


