EXAMPLE_INSTALL_PATH=$(PWD)
EXAMPLE_INSTALL_DIR=examples_install
EXAMPLE_INSTALL_PREFIX=$(EXAMPLE_INSTALL_PATH)/$(EXAMPLE_INSTALL_DIR)
NEWANALYSIS=$(EXAMPLE_INSTALL_DIR)/bin/newanalysis
UNDONEWANALYSIS=$(EXAMPLE_INSTALL_DIR)/bin/undonewanalysis

export SATIRE_INCLUDE=$(EXAMPLE_INSTALL_PREFIX)/include
export SATIRE_LIB=$(EXAMPLE_INSTALL_PREFIX)/lib


all:	$(EXAMPLE_INSTALL_DIR) newanalyses
	$(MAKE) -C sl1rd
	$(MAKE) -C sl2rd
	$(MAKE) -C constprop

newanalyses: sl1rd/Makefile sl2rd/Makefile constprop/Makefile

sl1rd/Makefile sl2rd/Makefile constprop/Makefile:
	$(NEWANALYSIS) sl1rd VarLabPairSetLifted
	$(NEWANALYSIS) sl2rd VarLabPairSetLifted
	$(NEWANALYSIS) constprop State


check:
	$(MAKE) check -C sl1rd
	$(MAKE) check -C sl2rd
	$(MAKE) check -C constprop

clean:
	if [ -e "sl1rd/Makefile" ]; then $(MAKE) clean -C sl1rd; fi
	if [ -e "sl2rd/Makefile" ]; then $(MAKE) clean -C sl2rd; fi
	if [ -e "constprop/Makefile" ]; then $(MAKE) clean -C constprop; fi
	if [ -e $(UNDONEWANALYSIS) ]; then $(UNDONEWANALYSIS) sl1rd; fi
	if [ -e $(UNDONEWANALYSIS) ]; then $(UNDONEWANALYSIS) sl2rd; fi
	if [ -e $(UNDONEWANALYSIS) ]; then $(UNDONEWANALYSIS) constprop; fi
	rm -rf $(EXAMPLE_INSTALL_DIR)

# we create a local install dir in 'examples' to allow using examples
# without any changes. Only *.set and *.optla files exist in example
# analysis directories. By using command 'newanalysis' all required
# files are generated by this make file.
$(EXAMPLE_INSTALL_DIR):
	$(MAKE) INSTALL_PREFIX=$(EXAMPLE_INSTALL_PREFIX) install -C ..
