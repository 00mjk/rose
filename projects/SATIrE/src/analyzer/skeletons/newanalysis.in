#!/bin/bash

#if [ $# -ne 2 ]
#then
#    echo "usage: newanalysis <name of analysis> <type of analysis carrier>"
#    exit 1
#fi

# Debugging:
# set -x

# Set default values
CURRENDIR=`pwd`
if [ x$1 = x ]
then
    ANALYSIS_DIR=$CURRENTDIR
    ANALYSIS_NAME=`basename $CURRENTDIR`
else
    ANALYSIS_DIR=$1
    ANALYSIS_NAME=$1
fi
if [ x$SATIRE_INCLUDE = x ]
then
  SATIRE_INCLUDE="@pkgdatadir@"
fi

# do the actual work
echo "creating new analysis $1..."
if [ -e "$ANALYSIS_DIR" ]
then
    echo "directory $ANALYSIS_DIR found."
else
    echo "creating directory $ANALYSIS_DIR ..."
    mkdir -p "$ANALYSIS_DIR"
fi
if [ -e "$ANALYSIS_DIR/anim-out" ]
then
    echo "directory $ANALYSIS_DIR/anim-out found."
else
    mkdir "$ANALYSIS_DIR/anim-out"
fi

echo "copying files..."
cp $SATIRE_INCLUDE/main.h-template $ANALYSIS_DIR/main.h
cp $SATIRE_INCLUDE/main.C-template $ANALYSIS_DIR/main.C
cp $SATIRE_INCLUDE/main-support.C-template $ANALYSIS_DIR/main-support.C
echo

if [ -e "$ANALYSIS_DIR/${ANALYSIS_NAME}.set" ]
then
  echo "$ANALYSIS_DIR/$ANALYSIS_NAME.set exists and remains in $ANALYSIS_DIR."
else
 echo "You must create $ANALYSIS_DIR/$ANALYSIS_NAME.set before you can compile the analyzer $ANALYSIS_DIR/$ANALYSIS_NAME."
fi

if [ -e "$ANALYSIS_DIR/$ANALYSIS_NAME.optla" ]
then
 echo "$ANALYSIS_DIR/$ANALYSIS_NAME.optla exists and remains in $ANALYSIS_DIR."
 echo "customizing Makefile..."
 echo "ANALYSIS = $ANALYSIS_NAME" > $ANALYSIS_DIR/Makefile
 CARRIER_TYPE=`egrep 'carrier[ ]*:' $ANALYSIS_DIR/$ANALYSIS_NAME.optla | awk --field-separator ':' '{ print $2 }' | sed 's/ //g'`
 echo "CARRIER_TYPE = $CARRIER_TYPE" >> $ANALYSIS_DIR/Makefile
 cat $SATIRE_INCLUDE/Makefile-template >> $ANALYSIS_DIR/Makefile
else
 echo "You must create $ANALYSIS_DIR/$ANALYSIS_NAME.optla before you can compile the analyzer $ANALYSIS_DIR/$ANALYSIS_NAME."
fi
echo
echo "All done, have fun."
