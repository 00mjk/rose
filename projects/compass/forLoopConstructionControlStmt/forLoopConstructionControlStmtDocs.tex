% 9.5.07
% This is a sample documentation for Compass in the tex format.
% We restrict the use of tex to the following subset of commands:
%
% \section, \subsection, \subsubsection, \paragraph
% \begin{enumerate} (no-nesting), \begin{quote}, \item
% {\tt ... }, {\bf ...}, {\it ... }
% \htmladdnormallink{}{}
% \begin{verbatim}...\end{verbatim} is reserved for code segments
% ...''
%

\section{For Loop Construction Control Stmt}
\label{ForLoopConstructionControlStmt::overview}

``ALE3D Coding Standards \& Style Guide'' item \#6.1 states that
\begin{quote}
for() construction loops must only include statements that control the loop. In particular, for() loops must not initialize or increment/decrement variables not directly related to the loop control.
\end{quote}

\subsection{Parameter Requirements}
This checker takes no parameters and inputs source file.

\subsection{Implementation}
This pattern is checked using a simple AST traversal that seeks out for loop statement constructs. Once a for loop is found the for loop construction block, e.g. for( ; ; ) is string searched for instances of the comma operator that indicates the use of non-control expressions in for loop construction code.

\subsection{Non-Compliant Code Example}
This non-compliant code initializes the array inside the for() control statement.

\begin{verbatim}
#include <stdlib.h>

int main()
{
  int *array = (int*)malloc( 100*sizeof(int) );
  for( int i = 0; i < 100; i++, array[i] = i ){}

  free(array);
  return 0;
} //main()
\end{verbatim}

\subsection{Compliant Solution}
The compliant solution simply moves the array initialization inside the for() loop body.

\begin{verbatim}
#include <stdlib.h>

int main()
{
  int *array = (int*)malloc( 100*sizeof(int) );
  for( int i = 0; i < 100; i++ ){ array[i] = i; }

  free(array);
  return 0;
} //main()
\end{verbatim}

\subsection{Mitigation Strategies}
\subsubsection{Static Analysis} 

Compliance with this rule can be checked using structural static analysis checkers using the following algorithm:

\begin{enumerate}
\item Perform simple AST traversal visiting all comma operator expressions.
\item For each comma operator expression node, if parent node is for loop statement then flag violation.
\item Report any violations. 
\end{enumerate}

\subsection{References}

Arrighi B., Neely R., Reus J. ``ALE3D Coding Standards \& Style Guide'', 2005.
