#!/bin/bash
# Does a thorough test
# Current working directory should be the top of the ROSE source tree
set -e

bindir=scripts/rgit/tests
[ -f "$bindir/setup-spizella.com" ] && . "$bindir/setup-spizella.com"
. $bindir/show-environment

run "build" "./build --verbose"
mkdir _build
cd _build

run "configure" \
    ../configure \
        --prefix=$(pwd)/installed \
        --with-C_DEBUG=-g       --with-CXX_DEBUG=-g \
        --with-C_WARNINGS=-Wall --with-CXX_WARNINGS=-Wall \
        --with-C_OPTIMIZE=-O0   --with-CXX_OPTIMIZE=-O0 \
        --with-CFLAGS=-fPIC     --with-CXXFLAGS=-fPIC \
        --with-ROSE_LONG_MAKE_CHECK_RULE=yes \
        --with-binarysql \
        --with-boost=$BOOST_ROOT \
        --with-dwarf=$DWARF_ROOT \
        --with-edg_source_code=true \
        --with-java \
        --with-javaport \
        --with-mysql \
        --with-pch \
        --with-roseQt \
        --with-sqlite3 \
        --with-qt=/usr --with-qt-lib=/usr/lib/qt4 \
        --enable-assembly-semantics \
        --enable-doxygen-developer-docs \
        --enable-dq-developer-tests \
        --enable-edg_union_struct_debugging \
        --enable-rosehpct


# be nice, no parallelism
run "make"           make
run "distcheck"      make distcheck
run "distclean"      make distclean
